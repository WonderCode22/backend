#if ($ctx.error)
  $util.error($ctx.error.message, $ctx.error.type)
#end

## Note: trying to #set() a variable to a computed null value
##       doesn't work. Avoid: #set($item = arrayWithNulls[$index])

#foreach ($user in $ctx.prev.result)
  #if ($util.isNull($user.followedStatus))
    #set ($index = $ctx.stash.userIdToIndex[$user.userId])
    ## Don't fill in NOT_FOLLOWING values because there's another lookup following this one
    #if (!$util.isNull($ctx.result.data.${table}[$index]))
      #set ($item = $ctx.result.data.${table}[$index])
      $util.qr($user.put('followedStatus', $item.followStatus))
    #end
  #end
#end

$util.toJson($ctx.prev.result)
